<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tasks | Ads Watch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative; /* ‡¶á‡¶®‡¶´‡ßã ‡¶Ü‡¶á‡¶ï‡¶®‡ßá‡¶∞ ‡¶™‡¶ú‡¶ø‡¶∂‡¶®‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
    }
    h2 {
      text-align: center;
      color: #1e3a8a;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .status-info {
      text-align: center;
      margin-top: 15px;
      font-size: 1.1em;
      background-color: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #c2e0f4;
    }
    .status-info p {
      margin: 6px 0;
    }
    .status-info span {
      font-weight: bold;
      color: #0d47a1;
    }
    video {
      width: 100%;
      border-radius: 10px;
      margin-top: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .btn {
      margin-top: 20px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }
    .btn i {
      margin-right: 8px;
    }
    .btn-start {
      background-color: #2196f3;
      color: white;
    }
    .btn-start:hover {
      background-color: #1e88e5;
    }
    .btn-submit {
      background-color: #4caf50;
      color: white;
    }
    .btn-submit:hover {
      background-color: #43a047;
    }
    .btn[disabled] {
      background-color: #9e9e9e;
      cursor: not-allowed;
    }
    #noTasksMsg {
      text-align: center;
      color: #2e7d32;
      font-weight: bold;
      margin-top: 20px;
      padding: 15px;
      background: #e8f5e9;
      border-radius: 8px;
    }
    #noPackageMsg {
      text-align: center;
      color: #c62828;
      font-weight: bold;
      margin-top: 20px;
      padding: 15px;
      background: #ffebee;
      border-radius: 8px;
    }
    
    /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤: ‡¶á‡¶®‡¶´‡ßã ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶™-‡¶Ü‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
    .info-icon {
        position: absolute;
        top: 30px;
        right: 30px;
        color: #1e3a8a;
        cursor: pointer;
        font-size: 20px;
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        animation: fadeIn 0.3s;
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #888;
        width: 80%;
        max-width: 400px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        animation: slideIn 0.3s;
    }
    .modal-content h3 {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1rem;
    }
    .modal-content p {
        font-size: 1rem;
        color: #555;
        line-height: 1.5;
    }
    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    .close-btn:hover, .close-btn:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideIn {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <i class="fas fa-info-circle info-icon" id="infoIcon"></i> <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶®‡¶´‡ßã ‡¶Ü‡¶á‡¶ï‡¶® -->
    <h2><i class="fas fa-play-circle"></i> Your Daily Ads</h2>
    <div id="statusInfo" class="status-info" style="display: none;">
      <p>Total Ads: <span id="totalAds">...</span></p>
      <p>Watched Today: <span id="adsWatched">...</span></p>
      <p>Remaining: <span id="adsRemaining">...</span></p>
    </div>

    <div id="taskSection" style="display: none;">
      <video id="adVideo" preload="auto"></video>
      <button id="actionBtn" class="btn btn-start"><i class="fas fa-play"></i> Start</button>
    </div>

    <div id="noPackageMsg" style="display: none;">
      ‚ùå ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶®‡ßá‡¶á‡•§ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®‡•§
    </div>

    <div id="noTasksMsg" style="display: none;">
      üéâ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶¨‡ßá‡¶®!
    </div>
  </div>

  <!-- ‡¶™‡¶™-‡¶Ü‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® HTML -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h3>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá?</h3>
      <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶π‡¶≤ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßá‡¶®‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 'Start' ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá 'Submit' ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡ß®‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶è‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¶‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡¶®‡¶æ‡•§ </p>
    </div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const adVideo = document.getElementById('adVideo');
    const actionBtn = document.getElementById('actionBtn');
    const statusInfo = document.getElementById('statusInfo');
    const noPackageMsg = document.getElementById('noPackageMsg');
    const noTasksMsg = document.getElementById('noTasksMsg');
    const totalAdsElem = document.getElementById('totalAds');
    const adsWatchedElem = document.getElementById('adsWatched');
    const adsRemainingElem = document.getElementById('adsRemaining');

    // ‚úÖ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì URL ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
    const adVideoUrls = [
      "https://ik.imagekit.io/ubdzcqpss/GR%2010%20sec%20ad.mp4?updatedAt=1755070813721",
      "https://ik.imagekit.io/ubdzcqpss/SSYouTube.online_Grant%20ROI%2010%20second%20TV%20Ad_1080p.mp4?updatedAt=1755070213649",
      "https://ik.imagekit.io/ubdzcqpss/SSYouTube.online_10%20seconds%20ad_720p.mp4?updatedAt=1755070213559",
      "https://ik.imagekit.io/ubdzcqpss/SSYouTube.online_Easy%20Commercial%2010%20Seconds%20Free%20Offer%20TaxSlayer.com_720p.mp4?updatedAt=1755070545140",
      "https://ik.imagekit.io/ubdzcqpss/SSYouTube.online_A1%20Marinades%20-%2010%20Second%20Digital%20Ad%20-%20Example_480p.mp4?updatedAt=1755070543415",
      "https://ik.imagekit.io/ubdzcqpss/OnTheMarket%20-%2010%20second%20TV%20advert%202024.mp4?updatedAt=1755070812601",
      "https://ik.imagekit.io/ubdzcqpss/ixigo%20tvc%20(TV%20commercial)%20-%2010%20sec.mp4?updatedAt=1755071175823",
      "https://ik.imagekit.io/ubdzcqpss/videoplayback.mp4?updatedAt=1755071174605",
    ];
    let currentAdIndex = 0;

    async function loadTaskStatus() {
      if (!token) {
        window.location.href = '/login';
        return;
      }
      try {
        const res = await fetch('/api/tasks/status', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();

        if (data.success) {
          if (data.hasPackage) {
            statusInfo.style.display = 'block';
            totalAdsElem.innerText = data.adsLimit;
            adsWatchedElem.innerText = data.adsWatched;
            adsRemainingElem.innerText = data.adsLimit - data.adsWatched;

            if (data.adsWatched < data.adsLimit) {
              document.getElementById('taskSection').style.display = 'block';
              loadRandomAd();
            } else {
              noTasksMsg.style.display = 'block';
            }
          } else {
            noPackageMsg.style.display = 'block';
          }
        } else {
          alert(data.message || 'Error fetching task status.');
        }
      } catch (err) {
        console.error("Error:", err);
        alert('Server error. Please try again.');
      }
    }

    function loadRandomAd() {
      // ‚úÖ ‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ‡¶≤‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ
      currentAdIndex = Math.floor(Math.random() * adVideoUrls.length);
      adVideo.src = adVideoUrls[currentAdIndex];
      actionBtn.innerHTML = '<i class="fas fa-play"></i> Start';
      actionBtn.className = 'btn btn-start';
      actionBtn.disabled = false;
    }

    actionBtn.addEventListener('click', () => {
      if (actionBtn.querySelector('i').classList.contains('fa-play')) {
        adVideo.play();
        actionBtn.disabled = true;
        
        // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        adVideo.onended = () => {
            actionBtn.innerHTML = '<i class="fas fa-check"></i> Submit';
            actionBtn.className = 'btn btn-submit';
            actionBtn.disabled = false;
        };
      } else if (actionBtn.querySelector('i').classList.contains('fa-check')) {
        submitTask();
      }
    });

    async function submitTask() {
      actionBtn.disabled = true;
      try {
        const res = await fetch('/api/tasks/complete', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        
        if (res.ok) {
          alert('‚úÖ Ad watched successfully! Balance updated.');
          loadTaskStatus();
        } else {
          alert(data.message || "Something went wrong!");
        }
      } catch (err) {
        console.error("Submit error:", err);
        alert("Server error. Could not submit task.");
      }
    }

    loadTaskStatus();

    // ‡¶®‡¶§‡ßÅ‡¶® JavaScript: ‡¶™‡¶™-‡¶Ü‡¶™‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶æ‡¶∞‡¶ø‡¶§‡¶æ
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById("infoModal");
      const infoIcon = document.getElementById("infoIcon");
      const closeBtn = document.getElementsByClassName("close-btn")[0];

      infoIcon.onclick = function() {
        modal.style.display = "block";
      }

      closeBtn.onclick = function() {
        modal.style.display = "none";
      }

      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    });
  </script>
</body>
</html>

